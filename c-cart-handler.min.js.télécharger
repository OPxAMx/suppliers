let c=localStorage.getItem("c")&&JSON.parse(localStorage.getItem("c"));async function uc(){if(c&&(document.querySelector(".cart")||document.querySelector(".modal-drop"))){let items=await fetch("/cart/img",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.map(e=>"id[]="+e.id).join("&")}).then(res=>{if(!res.ok)return Promise.reject(res);return res.json()});document.querySelectorAll(".modal-drop .cart-item").forEach(y=>y.remove());c.forEach(e=>{let[clone]=document.getElementById("cart-template").content.cloneNode(true).children;let{img,price}=items.find(o=>o.id===e.id);if(!img||!price)return;clone.dataset.id=e.id;clone.querySelector("img").src=img;clone.querySelector("#name").textContent=e.name;clone.querySelector(".cart-quantity > span").dataset.c=e.m;clone.querySelector(".cart-quantity > span").textContent=e.amount;clone.querySelector("#price").textContent=(e.amount*(price/100)).toFixed(2)+" $";document.querySelector(".cart")?.appendChild(clone);clone=clone.cloneNode(true);clone.classList.remove("item");clone.classList.add("cart-item");document.querySelector(".modal-drop").appendChild(clone)});stc()}document.querySelectorAll("#add").forEach(o=>{o.addEventListener("click",e=>{let p=e.currentTarget.parentElement.parentElement;let i=c.find(e=>e.id===p.dataset.id);if(i.amount+1<=Math.sqrt(Number("0x"+p.querySelector(".cart-quantity > span").dataset.c))){i.amount++;document.querySelectorAll(`[data-id="${p.dataset.id}"] > .cart-quantity > span`).forEach(t=>{t.textContent=i.amount});document.querySelectorAll(`[data-id="${p.dataset.id}"] #price`).forEach(t=>{t.textContent=(i.amount*(parseFloat(t.textContent.split(" ")[0])/(i.amount-1))).toFixed(2)+" $"});localStorage.setItem("c",JSON.stringify(c));stc()}})});document.querySelectorAll("#remove").forEach(o=>{o.addEventListener("click",e=>{let p=e.currentTarget.parentElement.parentElement;let i=c.find(e=>e.id===p.dataset.id);if(i.amount-1>0){i.amount--;document.querySelectorAll(`[data-id="${p.dataset.id}"] > .cart-quantity > span`).forEach(t=>{t.textContent=i.amount});document.querySelectorAll(`[data-id="${p.dataset.id}"] #price`).forEach(t=>{t.textContent=(i.amount*(parseFloat(t.textContent.split(" ")[0])/(i.amount+1))).toFixed(2)+" $"});localStorage.setItem("c",JSON.stringify(c));stc()}})});document.querySelectorAll("#trash").forEach(o=>{o.addEventListener("click",e=>{let p=e.currentTarget.parentElement;document.querySelectorAll(`[data-id="${p.dataset.id}"]:not(.page)`).forEach(e=>e.remove());c=c.filter(i=>i.id!==p.dataset.id);c.length>0?localStorage.setItem("c",JSON.stringify(c)):localStorage.removeItem("c");stc()})})}setTimeout(uc,50);document.querySelector(".checkout > #checkout")?.addEventListener("click",()=>{let c=localStorage.c&&JSON.parse(localStorage.c);if(!c)return alert("Aucun item dans le panier");fetch("/cart/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then(res=>{if(!res.ok)return Promise.reject(res.statusText);return res.json()}).then(({id})=>{location=`/checkout?id=${id}`}).catch(alert)});function stc(){if(!document.getElementById("sub"))return;let t=Array.from(document.querySelectorAll(".item #price")).reduce((o,e)=>o+parseFloat(e.textContent.replace(" $","")),0);document.getElementById("sub").textContent=t.toFixed(2)+" $";document.getElementById("full").textContent=(t*1.14975).toFixed(2)+" $";document.getElementById("tps").textContent=(t*.05).toFixed(2)+" $";document.getElementById("tvq").textContent=(t*.09975).toFixed(2)+" $"}